<!DOCTYPE html>
<html>
<head>
	<title id="t"> CSE IoT Lab</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div>
		<input type="button" id="device1off" value="Device 1 on" onclick="send_command('device1on')"/>
		<input type="button" id="device1off" value="Device 1 off" onclick="send_command('device1off')"/>
	</div>
	<div>
		<input type="button" id="device2on" value="Device 2 on" onclick="send_command('device2on')"/> 
		<input type="button" id="device2off" value="Device 2 off" onclick="send_command('device2off')"/>
	</div>
	<div>
		<input type="button" id="device3on" value="Device 3 on" onclick="send_command('device3on')"/>
		<input type="button" id="device3off" value="Device 3 off" onclick="send_command('device3off')"/>
	</div>
	<div id="sensor">Sensor reading</div>
	<div id="username_section">
			<input type="text" id="username" placeholder="Enter your name" /> 
			<input type="button" value="Send username" onclick="send_username()"/>
	</div>
	<div id="chat_section" style="display: none;">
			<input type="text" id="text"/>
			<input type="button" value="Send" id = "send" onclick="send_chat_message()"/>
			<div id = "chatbox"></div>
	</div>

	<script>
		
		var HOST = location.origin.replace(/^http/, 'ws');
		var ws = new WebSocket(HOST);
		

		ws.onmessage = function(msg){
			var json_data = JSON.parse(msg.data);
			switch (json_data.type){
				case "chat":
					document.getElementById("chatbox").innerHTML += "<br>"+json_data.text;
					break;
				case "sensor":
					document.getElementById("sensor").innerHTML = "Sensor reading: " + json_data.text;
					break;
			}
		}

		ws.onopen = function(){
			var msg = {
				type:"connection_type",
				text:"client_connection",
			};
			ws.send(JSON.stringify(msg));
		}
		function send_username(){
			var msg = {
				type:"username",
				text: document.getElementById("username").value,
			};
			ws.send(JSON.stringify(msg));
			document.getElementById("username_section").innerHTML = "Welcome:  " + msg.text ;
			document.getElementById("chat_section").style.display = "block";
		}
		function send_chat_message(){
			var msg = {
				type:"chat",
				text: document.getElementById("text").value,
			};
			ws.send(JSON.stringify(msg));
			document.getElementById("text").value="";
		}
		function send_command(command){
			var msg = {
				type:"command",
				text:command,
			};
			ws.send(JSON.stringify(msg));
		}

	</script>
</body>
</html>